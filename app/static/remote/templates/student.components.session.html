<ion-header-bar class='dark-bg-header mini-header'>

    <button class="button button-clear button-header-link" ng-click='goBack()'>Back</button>
    <h1 class="title">Session with {{session.request.guru.name.split(' ')[0]}}</h1>

    <div class='buttons'>
      <button class="button button-clear button-header-link submit-button" ng-click='showAttachActionSheet()'>
        <img class='icon ion-plus-custom blue custom-icon pure-img list-custom-icon' style='height:15px; margin-top:0.18em' src='{{img_base}}./img/paperclip-blue.svg' ng-show='!details.show'>
      </button>
      <button class="button button-clear button-header-link submit-button" ng-click='showAttachActionSheet()'>
        Help
      </button>
    </div>

  </ion-header-bar>

<div class="tabs home-request-tabs-top tabs-top">
      <a class="tab-item uppercase opacity-1-2" ng-click='showDetails()' ng-show='!details.show'>
        Details
      </a>
      <a class="tab-item uppercase blue-bg white-text" ng-click='showDetails()' ng-show='details.show'>
        Details
      </a>
      <a class="tab-item uppercase opacity-1-2" ng-click='showChat()' ng-show='details.show'>
        Chat
      </a>
      <a class="tab-item uppercase blue-bg white-text" ng-click='showChat()' ng-show='!details.show'>
        Chat
      </a>
</div>


<ion-content class='white-bg has-subheader' ng-show='details.show'>
      <div class='pure-g'>
          <ion-list class='pure-u-1'>

            <ion-item class='padding-1em item-avatar-left dark-bg white-text'>
              <img class='pure-img can-help-profile-img'  src='{{session.request.guru.profile_url}}'/>
                <div class='guru-info-wrapper'>
                  <h2>{{session.request.guru.name.split(' ')[0]}} </h2>
                  <p class='uppercase nano-text'>
                    <span ng-show='session.request.guru.university'>{{session.guru.university.title}}  -</span>
                    <span ng-show='session.request.guru.majors'>{{session.guru.majors[0].name}}</span>
                  </p>

                  <div class='pure-u-11-12'>
                    <div class='pure-u-1-12' ng-repeat='number in getNumber(session.guru.guru_avg_rating) track by $index'>
                            <i class='icon ion-star blue'></i>
                    </div>
                    <div class='pure-u-1-12' ng-repeat='number in getNumber(5 - session.guru.guru_avg_rating) track by $index'>
                      <i class='icon ion-star grey'></i>
                    </div>
                  </div>
                </div>
            </ion-item>


            <!-- 4.  jack dfrom student, put hashtags, icon right-->
            <ion-item class='item-avatar-left'>
              <img class='pure-img verb-img' ng-src='{{img_base}}./img/verbs/{{session.request.verb_image}}' />
                <h2 class='uppercase student-session-course-name'>{{session.request.course.short_name}}</h2>
            </ion-item>

            <ion-item class='item-avatar-left card-item-left request-form-item'>
              <img class='icon ion-plus-custom blue custom-icon pure-img' src='{{img_base}}./img/icons/clock.svg'>
              <p class='inline'> Starts in </p>
              <p ng-show='session.status === 1' class='inline time-until' style='padding-left:1em'> {{session.request.schedule_time}} minutes </p>
              <p ng-show='session.status === 2' class='inline time-until' style='padding-left:1em; color:green;'> In progress </p>
            </ion-item>

            <!-- 5.  Same old but no orange> -->
            <ion-item class='item-avatar-left card-item-left request-form-item'>
              <img class='icon ion-plus-custom blue custom-icon pure-img' src='{{img_base}}./img/icons/marker.svg'>
              <p class='inline'> Meet up </p>
              <p class='inline black' style='padding-left:1em'> {{session.request.address}} </p>
            </ion-item>

            <div class='item item-divider'>
            </div>

            <ion-item>
              <p class='pico-text white-space-normal'> {{session.request.description}} </p>
              <div class='pure-u-1'>
                <div class='pure-u-1-3 session-details-img-wrapper padding-right-half padding-top-half' ng-repeat='file in session.request.files'>
                  <img class='pure-img' src='{{file.url}}'/>
                </div>
              </div>
            </ion-item>

            <ion-item class='item-icon-left'>
              <img style='margin-top:0.4em; left:24px; top:5px;'class='icon ion-plus-custom blue custom-icon pure-img list-custom-icon' src='{{img_base}}./img/icons/tags.svg'>
              <p>&nbsp;<span class='blue request-tag' ng-repeat='tag in session.request.tags'>#{{tag.name}} </span> </p>
            </ion-item>


          </ion-list>
        <!-- </div> -->
    </div>

</ion-content>

<div ng-show='!details.show' >
  <ion-content delegate-handle="message-scroll" ng-click='setUnfocus()' class='white-background message-content has-subheader'>
        <ion-refresher
          pulling-icon="ion-arrow-down-c"
          spinner="circles"
          on-refresh="doRefresh()">
        </ion-refresher>
      <!-- <ion-scroll class="messages" ng-click="hideKeyboard()"> -->


        <div class='scroll pure-g-c flex-column center full-height message-content' ng-show='!messages || messages.length === 0'>
          <div class='padding-1em padding-1em flex-item-c'> </div>
          <div class='flex-item-c sleeping-guru light-opacity'>
            <img class='pure-img animated swing message-default-image' ng-src='{{img_base}}./img/guru-sleeping.svg' >
          </div>
          <div class='flex-item-c light-opacity padding-1em flex-direction-init '>
            <br>
            No messages yet.<br>
            <br>
            Start one with {{message_name}} now!
          </div>
        </div>

        <ul class="list message-item-list" style='margin-top:1em;'>
            <li class="item {{message.class}} message-item" ng-repeat="message in messages">
              <img ng-src="{{message.profile_url}}" ng-show='message.class === "item-avatar-left"'>
              <div class="text">
                <!-- <span class='sans-semibold' ng-show='message.sender.id !== user.id && message.sender.profile_url === default_profile_url'>{{message.sender.name.split(' ')[0]}}:</span> -->
                {{message.contents}}</div>
                <div class='text-time' ng-show='$index === messages.length - 1'>
                  {{message.formatted_time}} ago
                </div>
              <img ng-src="{{message.profile_url}}" ng-show='message.class === "item-avatar-right"'>
            </li>
        </ul>
      <!-- </ion-scroll> -->
    </ion-content>
    <ion-footer-bar class="bar-footer item-input-inset messages-footer-bar" keyboard-attach>
      <label class="item-input-wrapper">
          <i class="icon ion-search placeholder-icon"></i>
          <input type="search" name="message-input" class="form-control"
                  placeholder="Enter a message"
                  ng-model="new_message.content"
                  ng-focus="setFocus()"
                  ng-blur="setFocus()"
                  ng-keypress="checkSubmission($event)"
          />
      </label>

      <button class="button button-clear button-positive positive button-search" ng-show="new_message.content.length > 0" ng-click="sendMessage(new_message.content)">
      Send
      </button>
    </ion-footer-bar>
  </div>