{% extends 'base.html' %}

{% block content %}
<div id="message-list">
	<div class="page-title">
			  <div class="row" style="width:100%;text-align:center">
			      <div class="col-xs-1">
			        <a href="/activity/" style="text-decoration:none"> 
			          <h4 id="back-button"><span style="color:white" class="glyphicon glyphicon-chevron-left"></span> </h4>
			        </a>
			      </div>
			      <div class="col-xs-11" style="text-align:center">
			        <h4 style="color:white;width:100%;font-weight:500">
			        	YOUR MESSAGES
			        </h4>
			    </div>
			</div>
	</div>
	{% if not user.mailbox.conversation %}
		<div style="text-align:center" class="row-fluid">
				<br>
				<h4>
					{% if user.skills %}
					You have no conversations yet! You will be able to start a conversation once you've been matched with a tutor.
					{% else %}
					You have no conversations yet! You will be able to start a conversation once you've been matched with a student.
					{% endif %}
					<br>
					<br>
				</h4>
		</div>
	{% endif %}
	<div style="text-align:center"class="container-fluid" id="message-main">
	{% for conversation in user.mailbox.conversations %}
		<a id="conversation-{{loop.index}}" href="javascript:void(0)">
			<div class="notification" align:"center">
				{% if conversation.guru_id == user.id %}
					{% if conversation.student.profile_url %}
						<img src="{{conversation.student.profile_url}}" class="user-photo" style="float:left">
					{% else %}
						<img src="/static/img/default-photo.jpg" class="user-photo" style="float:left">
					{% endif %}
				{% else %}
					{% if conversation.guru.profile_url %}
					<img src="{{conversation.guru.profile_url}}" class="user-photo" style="float:left">
					{% else %}
					<img src="/static/img/default-photo.jpg" class="user-photo" style="float:left">
					{% endif %}
				{% endif %}
				<div style="float:left">
					{% if conversation.guru_id == user.id %}
						<h4><b>{{conversation.student.name.split()[0]}}</b></h4>
						<h5>Student</h5>
					{% else %}
						<h4><b>{{conversation.guru.name.split()[0]}}</b></h4>
						<h5>Tutor</h5>
					{% endif %}
					<div class="clear"></div>
					{% if conversation.messages %}
						<h6>Click here to continue the conversation</h6>
					{% else %}
						<h6>Click here to start the conversation</h6>
					{% endif %}
				</div>
				<div style="float:right;margin-top:30px">
					<span class="glyphicon glyphicon-chevron-right" style="color:#40bfec;float:right"></span>
				</div>
			</div>
		</a>
	{% endfor %}
	</div>
</div>
<div id="messages">
	{% for conversation in user.mailbox.conversations %}
		<div id="conversation-detailed-{{loop.index}}" style="display:none">
			<div class="page-title">
			  <div class="row" style="width:100%;text-align:center">
			      <div class="col-xs-1">
			        <a class="message-back-link" style="text-decoration:none"> 
			          <h4 id="back-button"><span style="color:white" class="glyphicon glyphicon-chevron-left"></span> </h4>
			        </a>
			      </div>
			      <div class="col-xs-11 col-md-10" style="text-align:center">
			        <h4 style="color:white;width:100%;font-weight:500">
			        	{% if conversation.guru_id == user.id %}
				   		<h4 style="color:white;">{{conversation.student.name.split()[0]|upper}}</h4>
				   		{% else %}
				   		<h4 style="color:white;">{{conversation.guru.name.split()[0]|upper}}</h4>
				   		{% endif %}
			        </h4>
			    </div>
			  </div>
			</div>
		  	<div style="height:100%; overflow:scroll"class="container-fluid conversation-messages">
					<div id="template-message" style="display:none"class="row">
						<div class="col-xs-12 col-sm-6 col-sm-offset-3 col-md-4 col-md-offset-4">
								<div style="padding-left:0px"class="col-md-8 col-xs-8" align="left">
									<div style="margin-top:-10px; padding:0px"class="col-xs-4 col-md-4"
										>
										{% if user.profile_url %}
										<img src= "{{user.profile_url}}" class="user-photo">
										{% else %}
										<img src= "{{conversation.student.profile_url}}" class="user-photo">
										<h6 style="margin:0">just now</h6>
										{% endif %}
									</div>
									<div style="padding-left:0px"align="left"class="col-xs-8 col-md-8">
										<div style="display:inline-block"class="chat-bubble"></div>
									</div>
								</div>
							</div>
						</div>
					{% for message in conversation.messages %}
					<br>
					<div class="row">
						<div class="col-xs-12 col-sm-6 col-sm-offset-3 col-md-4 col-md-offset-4">
								{% if message.sender_id == user.id %}
								<div style="padding-left:0px"class="col-md-8 col-xs-8" align="left">
									<div style="margin-top:-10px; padding:0px"class="col-xs-4 col-md-4">
										{% if conversation.guru_id == user.id %}
											{% if conversation.student.profile_url %}
											<img src= "{{conversation.student.profile_url}}" class="user-photo">
											{% else %}
											<img src= "/static/img/default-photo.jpg" class="user-photo">
											{% endif %}
										{% else %}
											{% if conversation.guru.profile_url %}
											<img src="{{conversation.guru.profile_url}}" class="user-photo">
											{% else %}
											<img src= "/static/img/default-photo.jpg" class="user-photo">
											{% endif %}
										{% endif %}
										<h6 style="margin:0">{{pretty_dates[message.id]}}</h6>
									</div>
									<div style="padding-left:0px"align="left"class="col-xs-8 col-md-8">
										<div style="display:inline-block"class="chat-bubble">{{message.contents}}</div>
									</div>
								</div>
								{% else %}
									<div class="col-md-offset-4 col-md-8"align="right">
										<div class="row">
											<div style="padding-right:0px"align="right"class="col-xs-9 col-md-9">
												<div style="display:inline-block"class="chat-bubble">{{message.contents}}</div>
											</div>
											<div style="margin-top:-10px; padding-right:0px"class="col-xs-3 col-md-3">
												{% if conversation.guru_id == user.id %}
													{% if conversation.student.profile_url %}
													<img src= "{{conversation.student.profile_url}}" class="user-photo">
													{% else %}
													<img src="/static/img/default-photo.jpg" class="user-photo" style="float:left">
													{% endif %}
												{% else %}
													{% if conversation.guru.profile_url %}
													<img src="{{conversation.guru.profile_url}}" class="user-photo">
													{% else %}
													<img src="/static/img/default-photo.jpg" class="user-photo" style="float:left">
													{% endif %}
												{% endif %}
												<span><h6>{{pretty_dates[message.id]}}</h6></span>
											</div>
										</div>
									</div>
								{% endif %}
						</div>
					</div>
					{% endfor %}
				</ul>
			</div>
			<br>
			<div id="message-sent" style="text-align:center; color:green; font-size:14px; display: none" class="row">
				Message Saved!
			</div>
			{% if not conversation.messages %}
			<div id="no-messages-yet"class="row-fluid">
				<div class="col-xs-12 col-sm-6 col-sm-offset-3 col-md-4 col-md-offset-4">
					<h4>
						You have no previous message history with this person. Start a conversation now!
						<br>
						<br>
					</h4>
				</div>
			</div>
			{% endif %}
			<div class="row-fluid">
				<div id="message-send-box" class="col-xs-12 col-sm-6 col-sm-offset-3 col-md-4 col-md-offset-4">
					<input class="input-message form-input" style="float:center; border-radius:8px; outline:none" placeholder="    Type a message here..." style="float:left"></input>
					<a class="submit-message" href="javascript:void(0);"/> <span style="font-size:20px"class="glyphicon glyphicon-send"></span> </a>
				</div>
			</div>
		</div>
	{% endfor %}
</div>
{% endblock %}

{% block footer_scripts %}
	<script src="/static/js/jquery-ui-custom.js"></script>
	<script src="/static/js/messages.js"></script>    
{% endblock %}