{% extends 'base.html' %}

{% block content %}
<div id="message-list">
	<div class="page-title">
			  <div class="row" style="width:100%;text-align:center">
			      <div class="col-xs-12 col-sm-12 col-md-12" style="text-align:center">
			        <h4 style="color:white;width:100%;font-weight:500">
			        	YOUR MESSAGES
			        </h4>
			    </div>
			</div>
	</div>
	{% if not user.mailbox.conversations %}
		<div style="text-align:center" class="row-fluid">
			  	<div style="margin-top:10px"class="row">
				  	<div class="col-xs-12 col-sm-offset-2 col-sm-8 col-md-offset-3 col-md-6">
				  		<div style="margin-bottom:10px"class="alert alert-success">
						  <strong>You're all done now!</strong><br>You will get a notification email as soon as you receive a request.
						</div>
				  	</div>	
				</div>
				<h5>
					{% if user.skills or user.verified_tutor %}
					This is where you will be able to start a conversation once you've been matched with a student.
					{% else %}
					This is where you will be able to start a conversation once you've been matched with a tutor.
					{% endif %}
					<br>
					<br>
				</h5>
				<div class="row-fluid">
					<div class="notification" style="margin-top:0;width:auto; cursor:auto"align:"center">
						<img src="/static/img/jenny.jpg" class="user-photo" style="float:left">
						<div style="float:left">
							<h4 style="margin-bottom:0px"><b> Jenny </b></h4>
							<h5 style="margin-top:0px;margin-bottom:0px"> {% if user.skills or user.verified_tutor %} Example Student {% else %} Example Tutor {% endif %}</h5>
							<h6 style="margin-top:5px"><i>You will be able to coordinate with your {% if user.skills or user.verified_tutor %} students {% else %} tutor {% endif %} here
								at the inbox once you are connected. This just an example. </i></h6>
						</div>
						<div style="float:right;margin-top:23px">
							<span class="glyphicon glyphicon-chevron-right" style="color:#40bfec;float:right"></span>
						</div>
					</div>
				</div>
		</div>
	{% else %}
	<div style="text-align:center" class="row-fluid">
	  	<div style="margin-top:10px"class="row">
		  	<div class="col-xs-12 col-sm-offset-2 col-sm-8 col-md-offset-3 col-md-6">
		  		<div style="margin-bottom:10px"class="alert alert-success">
				  Check your messages frequently! <br>We currently do not email you everytime you receive a message.
				</div>
		  	</div>	
		</div>
	</div>
	{% endif %}
	<br>
	<div style="text-align:center"class="container-fluid" id="message-main">
		<div class="row">
			<div id="message-feed"class="col-xs-12 col-sm-offset-3 col-sm-6 col-md-offset-3 col-md-6">
			{% for conversation in user.mailbox.conversations|reverse %}
			<a id="conversation-{{loop.index}}" href="javascript:void(0)">
				<div class="notification message {% if conversation.messages|length == 0 or (not conversation.is_read and conversation.messages[-1].sender_id != user.id) %} grey-background {% endif %}" align:"center">
					{% if conversation.guru_id == user.id %}
						{% if conversation.student.profile_url %}
							<img src="{{conversation.student.profile_url}}" class="user-photo" style="float:left">
						{% else %}
							<img src="/static/img/default-photo.jpg" class="user-photo" style="float:left">
						{% endif %}
					{% else %}
						{% if conversation.guru.profile_url %}
						<img src="{{conversation.guru.profile_url}}" class="user-photo" style="float:left">
						{% else %}
						<img src="/static/img/default-photo.jpg" class="user-photo" style="float:left">
						{% endif %}
					{% endif %}
					<div style="float:left">
						{% if conversation.guru_id == user.id %}
							<h4><b>{{conversation.student.name.split()[0]}}</b></h4>
							<h5>Student</h5>
						{% else %}
							<h4><b>{{conversation.guru.name.split()[0]}}</b></h4>
							<h5>Tutor</h5>
						{% endif %}
						<div class="clear"></div>
						{% if conversation.messages %}
							<h6><i>{{conversation.messages[-1].contents[0:50]}}...</i></h6>
						{% else %}
							<h6>Click here to start the conversation</h6>
						{% endif %}
					</div>
					<div style="float:right;margin-top:30px">
						<span class="glyphicon glyphicon-chevron-right" style="color:#40bfec;float:right"></span>
					</div>
				</div>
			</a>
			{% endfor %}
		</div>
	</div>
	</div>
</div>
<div id="messages">
	{% for conversation in user.mailbox.conversations|reverse %}
		<div id="conversation-detailed-{{loop.index}}" style="display:none; border:1px">
			<div class="page-title">
			  <div class="row" style="width:100%;text-align:center">
			      <div class="col-xs-1 col-md-offset-1 col-md-1">
			        <a class="message-back-link" style="text-decoration:none"> 
			          <h4 id="back-button"><span style="color:white" class="glyphicon glyphicon-chevron-left"></span> </h4>
			        </a>
			      </div>
			      <div class="col-xs-11 col-md-8" style="text-align:center">
			        <h4 style="color:white;width:100%;font-weight:500">
			        	{% if conversation.guru_id == user.id %}
				   		<h4 style="color:white;">{{conversation.student.name.split()[0]|upper}}</h4>
				   		{% else %}
				   		<h4 style="color:white;">{{conversation.guru.name.split()[0]|upper}}</h4>
				   		{% endif %}
			        </h4>
			    </div>
			  </div>
			</div>
			<br>
		  	<div class="container-fluid">
				<div style="position:relative" id="default-message-box" class="col-xs-12 col-sm-offset-2 col-sm-8 col-md-offset-3 col-md-6">		
					<div id="template-message" style="display:none"class="row">
						<div style="margin-left:15px; margin-top:15px;padding-left:0px; padding-right:5px"class="col-md-8 col-xs-8" align="left">
							<div style="margin-top:-10px; padding:0px; width:25%" class="col-xs-4 col-md-4">
								{% if conversation.guru_id == user.id %}
									<img src="{{conversation.guru.profile_url}}" class="user-photo">
								{% else %}
									<img src= "{{conversation.student.profile_url}}" class="user-photo">
								{% endif %}
								<h6 style="margin:0">Just Now</h6>
							</div>
							<div style="padding-left:0px"align="left"class="col-xs-8 col-md-8">
								<div style="display:inline-block"class="chat-bubble"></div>
							</div>
						</div>
					</div>
					<div class="conversation-messages" {% if not conversation.messages %} style="display:none" {% endif %}>
						{% for message in conversation.messages %}
						<br>
						<div class="row">
							{% if message.sender_id == user.id %}
							<div style="margin-left:15px; padding-left:0px; padding-right:5px"class="col-md-8 col-xs-8" align="left">
								<div style="margin-top:-10px; padding:0px; width:25%" class="col-xs-4 col-md-4">
									{% if conversation.guru_id == user.id %}
										<img src="{{conversation.guru.profile_url}}" class="user-photo">
									{% else %}
										<img src= "{{conversation.student.profile_url}}" class="user-photo">
									{% endif %}
									<h6 style="margin:0">{{pretty_dates[message.id]}}</h6>
								</div>
								<div style="padding-left:0px"align="left"class="col-xs-8 col-md-8">
									<div style="display:inline-block"class="chat-bubble">{{message.contents}}</div>
								</div>
							</div>
							{% else %}
								<div style="padding-right:0px; padding-left:0px"class="col-md-offset-4 col-md-8"align="right">
									<div class="row">
										<div style="padding-right:0px"align="right"class="col-xs-8 col-md-8">
											<div style="display:inline-block; margin-right:-45px;"class="chat-bubble">{{message.contents}}</div>
										</div>
										<div style="margin-top:-10px; width:22%;;padding-left:0px; margin-left:20px; padding-right:0px"class="col-xs-4 col-md-4">
											{% if conversation.guru_id == user.id %}
												<img src= "{{conversation.student.profile_url}}" class="user-photo">
											{% else %}
												<img src="{{conversation.guru.profile_url}}" class="user-photo">
											{% endif %}
											<span><h6 style="margin:0">{{pretty_dates[message.id]}}</h6></span>
										</div>
									</div>
								</div>
							{% endif %}
						</div>
						{% endfor %}
					</div>
					<br>
					<div id="message-sent" style="text-align:center; color:green; font-size:14px; display: none" class="row">
						Message Saved!
					</div>
					{% if not conversation.messages %}
					<div id="default-message-no-convo">
						<div id="no-messages-yet" style="margin-bottom:0px;"class="row-fluid">
								<h4 style="margin-bottom:0px;">
									You have no previous message history with this person. <br> Start a conversation now!
								</h4>
						</div>
						<br>
						<div style="text-align:center;"class="row">
							{% if user.id == conversation.guru_id %}
							<img src="{{conversation.student.profile_url}}" class="user-photo">
							{% else %}
							<img src="{{conversation.guru.profile_url}}" class="user-photo">
							{% endif %}
						</div>
						<div style="color:rgb(0, 159, 225);text-align:center;margin-top:10px; font-size:16px"class="row">
							We <b><i>highly recommend</b></i> the first person to message to fill out a <span style="text-decoration:underline"><a href="http://http://www.when2meet.com/">When2Meet</a></span> to help coordinate availability between you two! <br><br>Once you've created a unique link, post this in your conversation!
						</div>
					</div>
					<br>
					{% endif %}
					<div class="saved-message"class="row-fluid">
						Message Sent!
					</div>
					<div class="row-fluid">
						<div id="message-send-box">
							<div style="display:inline">
								<input class="input-message form-input" style="float:center;outline:none; border-radius:3px; padding:3px;" placeholder="  Type a message here..." style="float:left"></input>
							</div>
							<div style="display:inline">
								<a class="submit-message" href="javascript:void(0);"/> <span style="font-size:18px;"class="glyphicon glyphicon-send"></span> </a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	{% endfor %}
</div>
{% endblock %}

{% block footer_scripts %}
	<script src="/static/js/jquery-ui-custom.js"></script>
	<script src="/static/js/messages.js"></script>    
{% endblock %}