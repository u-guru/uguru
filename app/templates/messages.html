{% extends 'base.html' %}

{% block content %}
<div id="message-list">
	<div class="page-title">
		<div class="row" style="width:100%;text-align:center">
			<div class="col-xs-1 col-xs-offset-1">
				<a href="/activity/" style="text-decoration:none"> 
					<h4 id="back-button">< </h4>
				</a>
			</div>
			<div class="col-xs-8" style="text-align:center">
				<h4 style="color:white;width:100%">YOUR MESSAGES</h4>
			</div>
		</div>
	</div>
	<div class="container-fluid" id="message-main">
	{% for conversation in user.mailbox.conversations %}
		<a id="conversation-{{loop.index}}" href="javascript:void(0)">
			<div class="notification" align:"center">
				{% if conversation.guru_id == user.id %}
				<img src="{{conversation.student.profile_url}}" class="user-photo" style="float:left">
				{% else %}
				<img src="{{conversation.guru.profile_url}}" class="user-photo" style="float:left">
				{% endif %}
				<div style="float:left">
					{% if conversation.guru_id == user.id %}
						<h4><b>{{conversation.student.name}}</b></h4>
						<h5>Student</h5>
					{% else %}
						<h4><b>{{conversation.guru.name}}</b></h4>
						<h5>Tutor</h5>
					{% endif %}
					<div class="clear"></div>
					{% if conversation.messages %}
						<h6>Click here to continue the conversation</h6>
					{% else %}
						<h6>Click here to start the conversation</h6>
					{% endif %}
				</div>
				<div style="float:right;margin-top:30px">
					<span class="glyphicon glyphicon-chevron-right" style="color:#40bfec;float:right"></span>
				</div>
			</div>
		</a>
	{% endfor %}
	</div>
</div>
<div id="messages">
	{% for conversation in user.mailbox.conversations %}
		<div id="conversation-detailed-{{loop.index}}" style="display:none">
			<div class="page-title">
				<a href="javascript:void(0)" class= "message-back-link" style="float:left; margin-bottom:5px; color:white; text-decoration:none"> 
	   						< 
	   			</a>
	   			{% if conversation.guru_id == user.id %}
		   		<h4 style="color:white;">Your Conversation with {{conversation.student.name}}</h4>
		   		{% else %}
		   		<h4 style="color:white;">Your Conversation with {{conversation.guru.name}}</h4>
		   		{% endif %}
		  	</div>

		  	<div class="container-fluid conversation-messages">
			  	<br>
			  	<br>
			  	<ul>
					<li id="template-message" style="display:none">
						<div align="left" style="margin-bottom:30px">
						<img src="{{user.profile_url}}" class="user-photo" >
						<span class="chat-bubble"> </span>
						<h5></h5>
						</div>
					</li>
					{% for message in conversation.messages %}
					<li>
						{% if message.sender_id == user.id %}
						<div align="left" style="margin-bottom:30px">
						{% else %}
						<div align="right" style="margin-bottom:30px">
						{% endif %}

							{% if message.sender_id == user.id %}
							<img src="{{user.profile_url}}" class="user-photo" >
							{% else %}
								{% if conversation.guru_id == user.id %}
									<img src="{{conversation.student.profile_url}}" class="user-photo">
								{% else %}
									<img src="{{conversation.guru.profile_url}}" class="user-photo">
								{% endif %}
							{% endif %}
							<span class="chat-bubble">{{message.contents}}</span>
							<h5>{{message.write_time}}</h5>
						</div>
					</li>
					{% endfor %}
				</ul>
			</div>
			<div id="message-saved" style="text-align:center; color:green; font-size:14px; display: none" class="row">
				Message Saved!
			</div>
			<div class="row" style="text-align:center; color:black">
				<input class="input-message" style="float:center" placeholder="Type a message here..." style="float:left"></input>
				<br>
				<a class="submit-message" href="javascript:void(0);"/> submit </a>
			</div>
		</div>
	{% endfor %}
</div>
{% endblock %}

{% block footer_scripts %}
	<script src="/static/js/jquery-ui-custom.js"></script>
	<script src="/static/js/messages.js"></script>    
{% endblock %}