{% macro request_details(user, notif, request_dict, time, index) -%}                        
{% set student_name = notif.feed_message.split(" ")[3] %}
    <div class='row center margin-top-20'>
        <span id='profile-name' class="font-24 center">
        {% if notif.custom != 'tutor-is-matched' %}
            {{notif.feed_message|safe}} 
        {% else %}
            <span class='green-text'>{{student_name}} </span> Chose You!
        {% endif %}
        </span>
    </div>
    {% if notif.custom == 'tutor-is-matched' %}
        <div class='row center margin-top-10 font-20'>
            <span class='green-text'>${{request_dict[notif.request_id]['request'].time_estimate * request_dict[notif.request_id]['request'].student_estimated_hour * 0.75}}</span> Has Been Added To Your Balance!
        </div>
    {% endif %}


    {% if notif.custom ==  'tutor-is-matched' %}
    <div class='row-fluid margin-top-40 block'>
        <label class='font-20 green-text'> Next Steps </label>
        <br>
        <br>
        <div id='guru-intro' class='block font-14'>
            <p> 1. <a href='/messages/' class='blue-text'><u> Message</u></a> your student <span class='green-text'>ASAP</span> to confirm meeting time and location. </p>
            <p> 2. No need to ask for cash, you will get paid through Uguru. </p>
        </div>
        <br>
    </div>
    <hr>
    {% endif %}

    {% if notif.custom_tag == 'student-request-help' %}
    <div class='row-fluid margin-top-20'>
        <label class='font-20 green-text'> Next Steps </label>
        <div id='guru-intro' class='block font-14'>
            <p> Up to <span class='green-text'> 3 </span> Gurus will respond to your request very soon. Pick one before your session expires in <span class='green-text'> 48 hours.</span></p>
        </div>
    </div>
    <div class='row-fluid align-left font-14'>
        <a class="cancel-request blue-text" href="javascript:void(0)"> <u>Need to Cancel? </u></a>
    </div>
    <hr>
    {% elif notif.custom =='tutor-accept-request' %}
    <div class='row-fluid margin-top-20'>
        <label class='font-20 green-text'> Next Steps </label>
        <div id='guru-intro' class='block font-14'>
            You replied to the request before other Gurus, so you are 1 of the 3 Gurus the student can choose from! 
            <br>
            <br>
            We will let you know if the student chooses you or not. Just relax and wait!
        </div>
    </div>
    <!-- <div class='row-fluid align-left font-14'>
        <a class="cancel-request blue-text" href="javascript:void(0)"> <u>Need to Cancel? </u></a>
    </div> -->
    <hr>
    {% endif %}
    <div class='request-details-attribute-container margin-top-30 margin-bottom-15 block'>
        <img id='request-details-photo' src='{{user.profile_url}}' height='130px'> 
        <br>
        {% if request_dict[notif.request_id]['request'].urgency %}
            <div class='row margin-top-10 margin-left'>
                <img src='/static/img/asap.png' height='20px'> <span class='font-12'>I need help asap!</span>
            </div>
        {% endif %}
        {% if request_dict[notif.request_id]['request'].frequency %}
            <div class='row margin-top-10 margin-left'>
                <img src='/static/img/frequency.png' height='20px'> 
                <span class='font-12 '>
                    I will potentially meet <br> with the Guru again.
                </span>
            </div>
        {% endif %}
        <div class='guru-profile-attributes'> 
            <div class='row font-14 reg-text'>
                Professor: 
                <span class='green-text'> {{request_dict[notif.request_id]['request'].professor}}
                </span>
            </div>
            <div class='row font-14 margin-top-15 reg-text'>
                Preferred Meeting Location: 
                <span class='green-text'> {{request_dict[notif.request_id]['request'].location}}
                </span>
            </div>

            {% if notif.custom_tag == 'student-request-help' %}
            <div class='row font-14 margin-top-15 reg-text'>
                Meeting Time:
                <span class='green-text'> 
                    {% if request_dict[notif.request_id]['student-calendar'] %}
                        <span class='green-text'> See times: </span> 

                        <a id='request-calendar-toggle' onclick='show_student_request_calendar({{request_dict[notif.request_id]["student-calendar"]}}, {{time.mktime(request_dict[notif.request_id]["request"].time_created.timetuple())}})'>
                            <span class='glyphicon glyphicon-calendar'></span>
                        </a>
                    {% else %}
                        
                        {{request_dict[notif.request_id]['request'].availability}}

                    {% endif %}
                </span>
            </div>
            {% endif %}

            {% if notif.custom_tag == 'tutor-request-offer' %}
                <div class='row font-14 margin-top-15 red-text'>
                    {% if notif.custom == 'tutor-accept-request' and not request_dict[notif.request_id]['request'].connected_tutor_id == request_dict[notif.request_id]['student'].id%}
                      <a id='request-calendar-toggle' onclick='show_tutor_request_submitted_calendar({{request_dict[notif.request_id]["student-calendar"]}}, {{request_dict[notif.request_id]["tutor-calendars"][user.id]}}, false, {{time.mktime(request_dict[notif.request_id]["request"].time_created.timetuple())}})'>
                        <span class='red-text'> See chosen time: </span> 
                        <span class='glyphicon glyphicon-calendar'></span>
                      </a>
                    {% else %}
                      <a class='pointer' id='request-calendar-toggle' onclick='show_tutor_request_calendar({{request_dict[notif.request_id]["student-calendar"]}},{{request_dict[notif.request_id]["request"].time_estimate}}, {{time.mktime(request_dict[notif.request_id]["request"].time_created.timetuple())}})'>
                        <span class='glyphicon glyphicon-calendar'></span>
                        <span class='blue-text'> <u>Pick a Meeting Time</u></span> 
                      </a>
                    {% endif %}
                </div>
            {% endif %}

            <div class='row font-14 margin-top-15 reg-text'>
                This Session Would Take: 
                <span class='green-text'> <span id='session-length-{{index}}'>{{request_dict[notif.request_id]['request'].time_estimate}}</span> hours
                </span>
            </div>
            
            <div class='row font-14 margin-top-15 reg-text'>
                Hourly Rate:
                <span class='green-text'> $<span id='student-offer-hourly-price-{{index}}'>{{request_dict[notif.request_id]['request'].student_estimated_hour}}</span>/hr
                </span> 
                
                {% if notif.custom_tag == 'tutor-request-offer' and not notif.custom == 'tutor-accept-request' %}
                &nbsp;&nbsp;&nbsp;
                <a id="tutor-change-price-link-{{index}}" class="tutor-change-price-link" href="javascript:void(0);">
                    <span class='glyphicon glyphicon-pencil blue-text'> </span>
                </a>
                <a class="tutor-change-price-cancel" style='display:none' id="tutor-change-price-cancel-{{index}}" href="javascript:void(0);">
                    <span class='glyphicon glyphicon-remove blue-text float-right'> </span>
                </a>
                <br>
                <div style="display:none; width:100%" id="tutor-change-price-slider-div-{{index}}">
                        <div style="margin:auto;" id="tutor-change-price-slider-{{index}}" class="tutor-change-price-slider"></div>
                </div>

                {% endif %}

            </div>

            {% if notif.custom_tag == 'tutor-request-offer' or notif.custom == 'tutor-accept-request' or notif.custom == 'tutor-is-matched' %}
            <div class='row font-14 margin-top-15 reg-text'>
                    You will make:
                    <b>
                    <span class='green-text'> $<span id='you-will-make-{{index}}'>{{request_dict[notif.request_id]['request'].time_estimate * request_dict[notif.request_id]['request'].student_estimated_hour * 0.75}} </span> 
                    </b>
                    </span> 
                    <br>
                    <span class='font-10'> We take 25% of your <b>first</b> transaction with {{student_name}}. </span>
            </div>
            {% endif %}
        </div>
    </div>
    <div class='row block margin-top-40' style='padding-left:16px'>
        <label class='font-20'> Additional Details </label>
        <div id='guru-intro' class='block font-14'>
            {{request_dict[notif.request_id]['request'].description}}
        </div>
        <br>
    </div>

    {% if notif.custom_tag == 'student-request-help' %}
        <div class='row block margin-top-10' style='padding-left:16px'>
            <label class='font-20'> Contacted Tutors ({{request_dict[notif.request_id]['request'].requested_tutors|length}}) </label>
            <div id="contacted-tutors">
                {% for tutor in request_dict[notif.request_id]['request'].requested_tutors %}
                <span>
                    <img src="{{tutor.profile_url}}" style="align:center" class="tutor-photo"> 
                </span>
                {% endfor %}
            </div>
            <br>
        </div>
    {% endif %}

    {% if notif.custom_tag == 'tutor-request-offer' and not notif.custom == 'tutor-accept-request' and not notif.custom == 'tutor-is-matched' %}
    <hr style='color:grey; margin-top:10px'>
    <div class='row block margin-top-10 margin-bottom-20' style='padding-left:16px'>
        <label class='font-20'> Your Personal Message To {{student_name|safe}} </label>
        <div class='font-14 block margin-bottom-15'>
            Include a message to address {{student_name}}'s request and market yourself!
        </div>
        <textarea class='form-control standard-textarea guru-request-reply-textarea'></textarea>
        <div class='row-fluid font-20 margin-top-40 margin-bottom-20 center'>
            <div class='center red-text font-12 extra-detail-alert'  style='display:none'>
            </div>
            <br>
            <a href='javascript:void(0);' class='tutor-request-accept-btn'>
                <span class='blue-btn' style='padding:8px 60px'> Accept This Offer </span>
            </a>
        </div>
    </div>
    {% endif %}

    {% if notif.custom ==  'tutor-is-matched' %}
    <div class='row-fluid font-20 margin-top-40 margin-bottom-20 center'>
        <a href="/messages/" >
            <span class='blue-btn' style='padding:8px 60px'> Message Your Student </span>
        </a>
    </div>

    {% endif %}

{%- endmacro %}