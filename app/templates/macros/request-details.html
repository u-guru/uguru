
{% macro request_details(user, notif, request_dict, time, index, user_avg_rating=None) -%}                        
{% set student_name = request_dict[notif.request_id]['student'].name.split(" ")[0] %}
{% if (user.approved_by_admin and user.verified_tutor and (not user.skills or not user.tutor_introduction or not user.major or not user.year or not user.phone_number or (user.profile_url == '/static/img/default-photo.jpg'))) %}
        {% set guru_profile_not_complete = true %}
{% else %}  
        {% set guru_profile_not_complete = false %}
{% endif %}

{% if notif.custom_tag == 'tutor-request-offer' and user.approved_by_admin and user_avg_rating[0] < 4.0 %}
    {% set guru_not_ready = true %}
{% else %}
    {% set guru_not_ready = false %}
{% endif %}
    
    {% if notif.status == 'LATE' %}
        <div class='row center margin-top-10 font-24 red-text'>
            You Are Too Late...
        </div>
        <div class='row-fluid margin-top-30 margin-top-30-mobile'>
        <label class='font-20 green-text'> Next Steps </label>
        <div id='guru-intro' class='block font-14'>
            Sorry, other Gurus have already filled up the 3 available spots for this student. 
            <br>
            <br>
            Add your phone number in <a href='/settings/#prof' class='blue-text'> settings </a> to get notified when students need help.
        </div>
    </div>

    {% endif %}

    {% if notif.status == 'Canceled' %}
        <div class='row center margin-top-10 font-24 red-text'>
            Sorry! <br>The Student has Canceled the Request.
        </div>
        <div class='row-fluid margin-top-30'>
        <label class='font-20 green-text'> Next Steps </label>
        <div id='guru-intro' class='block font-14'>
            Stay tuned! We'll immediately let you know when a student needs help in a course.
        </div>
    </div>
    <hr>

    {% endif %}

    {% if guru_profile_not_complete and notif.status != 'LATE' %}
    <div class='row'>
        <div style="margin-top:0px; margin-bottom:15px; text-align:center; float:center"class="col-xs-12 col-sm-12 col-md-12">
            <div style="margin-bottom:0"class="alert alert-danger">
                You must complete your profile to accept! Complete <a href='/settings/#prof'>here.</a>
            </div>
        </div>
    </div>
    {% endif %}

    <div id='request-details-header' class='row center margin-top-20'>
        <span id='profile-name' class="font-24 center">
        {% if notif.custom != 'tutor-is-matched' and not notif.status == 'LATE' and not notif.status == 'Taken' %}
            {{notif.feed_message|safe}} 
        {% elif notif.custom == 'tutor-is-matched' %}
            <span class='green-text'>{{student_name}} </span> Chose You!
        {% elif notif.status == 'Taken' %}
            <span class='red-text'>
                Sorry! The Student Chose Another Guru
            </span>
        {% else %}
        <hr>
        {% endif %}
        </span>
    </div>
    {% if notif.custom == 'tutor-is-matched' and not guru_not_ready %}
        <div class='row center margin-top-10 font-20 student-chose-you'>
            <span class='green-text'>${{request_dict[notif.request_id]['request'].time_estimate * request_dict[notif.request_id]['request'].student_estimated_hour * 0.75}}</span> Has Been Added To Your Balance! 
        </div>
    {% endif %}


    {% if notif.custom ==  'tutor-is-matched' %}
    <div class='row-fluid margin-top-40 margin-top-40-mobile block'>
        <label class='font-20 green-text'> Next Steps </label>
        <br>
        <br>
        <div id='guru-intro' class='block font-14 next-steps-guru-match'>
            <p> 1. <a href='/messages/' class='blue-text'><u> Message</u></a> your student <span class='green-text'>ASAP</span> to confirm meeting time and location. </p>
            <p> 2. No need to ask for cash, you will get paid through Uguru. </p>
        </div>
        <br class='mobile'>
    </div>
    <hr>
    {% endif %}

    {% if guru_not_ready and notif.status != 'LATE' and notif.custom !='tutor-accept-request'%}
    <div class='row-fluid margin-top-40 block'>
        {% if user_avg_rating[0] == 0 %}
        <label class='font-16 red-text'> This is your first time! What does this mean?</label>
        {% else %}
        <label class='font-16 red-text'> 
            Your current ratings do not qualify you to charge yet.
        </label>
        {% endif %}
        <div id='guru-intro' class='block font-14'>
            <p> 1. You can't ask for money until you average 4.0 stars (all you need is a 4 or 5 star review on this first session). </p>
            <p> 2. Read more about why we do this <a href='tinyurl.com/uguru-q-a' class='blue-text'> here</a>. </p>
        </div>
        <br>
    </div>
    <hr>
    {% endif %}

    {% if notif.custom_tag == 'student-request-help' %}
    <div class='row-fluid margin-top-20'>
        <label class='font-20 green-text'> Next Steps </label>
        <div id='guru-intro' class='block font-14'>
            <p> Up to <span class='green-text'> 3 </span> Gurus will respond to your request very soon. Pick one before your session expires in <span class='green-text'> 48 hours.</span></p>
        </div>
    </div>
    <div class='row-fluid align-left font-14'>
        <a class="cancel-request blue-text" href="javascript:void(0)"> <u>Need to Cancel? </u></a>
    </div>
    <hr>
    {% elif notif.custom =='tutor-accept-request' and notif.status != 'Taken' and notif.status != 'Canceled'%}
    <div class='row-fluid margin-top-20'>
        <label class='font-20 green-text'> Next Steps </label>
        <div id='guru-intro' class='block font-14'>
            You replied to the request before other Gurus, so you are 1 of the 3 Gurus the student can choose from! 
            <br>
            <br>
            We will let you know if the student chooses you or not. Just relax and wait!
        </div>
    </div>
    <hr>
    {% elif notif.custom =='tutor-accept-request' and notif.status == 'Taken'%}
    <div class='row-fluid margin-top-20'>
        <label class='font-20 green-text'> Your Next Steps </label>
        <div id='guru-intro' class='block font-14'> 
            You were still one of the first 3 Gurus-- great job on replying quickly!
            <br>
            <br>
            We highly recommend that your personal response to the student is as detailed and friendly as possible.
            <br>
            <br>
            Our studies show that this differentiates you the most from other Gurus.
            <br>
            <br>
        </div>
    </div>
    <hr>
    {% endif %}
    <div class='request-details-attribute-container margin-top-30 margin-bottom-15 block'>
        <img id='request-details-photo' src='{{request_dict[notif.request_id]["student"].profile_url}}' height='130px'> 
        <br>
        {% if request_dict[notif.request_id]['request'].urgency %}
            <div class='row margin-top-10 margin-left'>
                <img src='/static/img/asap.png' class='asap-img' height='20px'> <span class='font-14 asap-text'>I need help <b>ASAP</b>!</span>
            </div>
        {% endif %}
        {% if request_dict[notif.request_id]['request'].frequency %}
            <div class='row margin-top-10 margin-left'>
                <img src='/static/img/frequency.png' height='20px'> 
                <span class='font-12 '>
                    I will potentially meet <br> with the Guru again.
                </span>
            </div>
        {% endif %}
        <div class='guru-profile-attributes'> 
            <div class='row font-14 margin-top-15 reg-text'>
                Preferred Meeting Location: 
                <span class='green-text'> {{request_dict[notif.request_id]['request'].location}}
                </span>
            </div>

            <div class='row font-14 margin-top-15 reg-text'>
                Remote Friendly:
                <span class='green-text'> {{request_dict[notif.request_id]['request'].remote}}
                </span>
            </div>

            {% if notif.custom_tag == 'student-request-help' %}
                {% if request_dict[notif.request_id]['request'].availability %}
                <div class='row font-14 margin-top-15 reg-text'>
                    Meeting Time:
                    <span class='green-text'> 
                    </span>
                </div>
                {% endif%}
            {% endif %}
            <div class='row font-14 margin-top-15 reg-text'>
                This Session Would Take: 
                <span class='green-text'> <span id='session-length-{{index}}'>{{request_dict[notif.request_id]['request'].time_estimate}}</span> hours
                </span>
            </div>
            
            <div class='row font-14 margin-top-15 reg-text'>
                {% if not guru_not_ready %}
                Hourly Rate:
                <span class='green-text'> $<span id='student-offer-hourly-price-{{index}}'>{{request_dict[notif.request_id]['request'].student_estimated_hour}}</span>/hr
                </span> 
                {% else %}
                First Time Guru Hourly Rate:
                <span class='green-text'> <b>$<span id='student-offer-hourly-price-{{index}}'>0</span>/hr</b> </span> <br> <span class='grey-text font-12'> (${{request_dict[notif.request_id]['request'].student_estimated_hour}}/hr when you have 4.0 stars avg rating)</span>
                {% endif %}
                
                {% if notif.custom_tag == 'tutor-request-offer' and not notif.custom == 'tutor-accept-request' and not notif.status =='LATE' and not guru_not_ready %}
                &nbsp;&nbsp;&nbsp;
                <a id="tutor-change-price-link-{{index}}" class="tutor-change-price-link" href="javascript:void(0);">
                    <span class='glyphicon glyphicon-pencil blue-text'> </span>
                </a>
                <a class="tutor-change-price-cancel" style='display:none' id="tutor-change-price-cancel-{{index}}" href="javascript:void(0);">
                    <span class='glyphicon glyphicon-remove blue-text float-right'> </span>
                </a>
                <br>
                <div style="display:none; width:100%" id="tutor-change-price-slider-div-{{index}}">
                        <div style="margin:auto;" id="tutor-change-price-slider-{{index}}" class="tutor-change-price-slider"></div>
                </div>

                {% endif %}

            </div>

            {% if notif.custom_tag == 'tutor-request-offer' or notif.custom == 'tutor-accept-request' or notif.custom == 'tutor-is-matched' %}
            <div class='row font-14 margin-top-15 reg-text'>
                    {% if not guru_not_ready %}
                    You will make:
                    <b>
                    <span class='green-text'> $<span id='you-will-make-{{index}}'>{{request_dict[notif.request_id]['request'].time_estimate * request_dict[notif.request_id]['request'].student_estimated_hour * 0.75}} </span> 
                    </b>
                    </span> 
                    <br>
                    <span class='font-10 twenty-five-percent-transaction'> We deduct 25% of your <b>first</b> transaction with a student. </span>
                    {% else %}
                    Next Time You Could Make
                    <span class='green-text'> $<span id='you-will-make-{{index}}'>{{request_dict[notif.request_id]['request'].time_estimate * request_dict[notif.request_id]['request'].student_estimated_hour * 0.75}} </span> 
                    </span> 
                    <br>
                    <span class='font-10'> We deduct 25% of your <b>first</b> transaction with a student. </span>
                    {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
    <div class='row block margin-top-40 additional-details' style='padding-left:16px'>
        <label class='font-20'> Additional Details </label>
        <div id='guru-intro' class='block font-14'>
            {{request_dict[notif.request_id]['request'].description}}
        </div>
        <br>
    </div>

    {% if notif.custom_tag == 'student-request-help' %}
        <div class='row block margin-top-10 contacted-tutors' style='padding-left:16px'>
            <label class='font-20'> Contacted Tutors ({{request_dict[notif.request_id]['request'].requested_tutors|length}}) </label>
            <div id="contacted-tutors">
                {% for tutor in request_dict[notif.request_id]['request'].requested_tutors %}
                <span>
                    <img src="{{tutor.profile_url}}" style="align:center" class="tutor-photo"> 
                </span>
                {% endfor %}
            </div>
            <br>
        </div>
    {% endif %}

    {% if notif.custom_tag == 'tutor-request-offer' and not notif.custom == 'tutor-accept-request' and not notif.custom == 'tutor-is-matched' and not notif.status =='LATE'%}
    <hr style='color:grey; margin-top:10px'>
    <div class='row block margin-top-10 margin-bottom-20' style='padding-left:16px'>
        <label class='font-20'> Your Personal Message To {{student_name|safe}} </label>
        <div class='font-14 block'>
            Include a message to address {{student_name}}'s request and market yourself!
        </div>
        {% if guru_not_ready %}
        <div class='font-12 block margin-bottom-10 margin-top-5 grey-text'>
            Feel free to go above and beyond here! This is your first time, and the student may receive offers from more qualified Gurus on the platform.
        </div>
        {% endif %}
        <textarea class='form-control standard-textarea guru-request-reply-textarea' style='width:97.5%'></textarea>
        <div class='row-fluid font-20 margin-top-20 margin-bottom-20 center'>
            <div class='center red-text font-12 extra-detail-alert'  style='display:none'>
            </div>
            <br>
            <a {% if guru_profile_not_complete %} href='javascript:void(0);' onclick='alert("Please complete your Guru Profile first.")' {% else %} href='javascript:void(0);' class='tutor-request-accept-btn' {%endif%}>
                <span class='blue-btn blue-btn-full clickable'> Accept This Offer </span>
            </a>
        </div>
        <div class='row-fluid grey-text font-12 center'>
            Only accept this offer if you are <b>100% confident</b> with the task. <br>(you've done well in the course, or are a grad student)
        </div>
    </div>
    {% endif %}

    {% if notif.custom ==  'tutor-is-matched' %}
    <div class='row-fluid font-20 margin-top-40 margin-bottom-20 center message-container-student'>
        <a href="/messages/" >
            <span class='blue-btn message-your-student-mobile clickable' style='padding:8px 60px'> Message Your Student </span>
        </a>
    </div>

    {% endif %}

{%- endmacro %}