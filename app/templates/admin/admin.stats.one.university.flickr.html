{% extends 'admin/base.html' %}

{% block header_scripts %}
<link href="/static/admin/plugins/ionslider/ion.rangeSlider.css" rel="stylesheet" type="text/css" />
    <!-- ion slider Nice -->
    <link href="/static/admin/plugins/ionslider/ion.rangeSlider.skinNice.css" rel="stylesheet" type="text/css" />
    <link href="/static/admin/plugins/datepicker/datepicker3.css" rel="stylesheet" type="text/css" />
    <link href="/static/admin/plugins/timepicker/bootstrap-timepicker.min.css" rel="stylesheet"/>
{% endblock %}

{% block content %}
 <!-- Content Wrapper. Contains page content -->

      <div class="content-wrapper" style="min-height: 918px;">
        <!-- Content Header (Page header) -->
        <section class="content-header">
          <h1>

            <!-- An example of wasting time doing formatting lol -- not our job -->

              <img src='{{university.logo_url}}' height="40" width="40">
            <!-- The nbsp; are required spaces -->
            &nbsp;&nbsp;&nbsp;
            {{university.name}}
            <small><strong> {{university.city}}, {{university.state}}</strong></small>
          </h1>
          <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-bar-chart-o"></i> Home</a></li>
            <li>Stats</li>
            <li class="active">Devices</li>
          </ol>
        </section>


        <section class="content">

         <div class="row">
            <div class="col-md-12">
              <!-- USERS LIST -->
              <div class="box box-danger">
                <div class="box-header with-border">
                  <h3 class="box-title">{{university.name}}</h3>
                  <div class="box-tools pull-right">
                    <span class="label label-warning">These universities are insignificant</span>
                    <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                    <button class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                  </div>
                </div><!-- /.box-header -->
                <div class="box-body no-padding">
                  <ul class="users-list clearfix">
                    {% for photo in flickr_arr %}
                    <li style="position:relative; width:50%; padding:5%; max-height:300px; height:300px;">
                      <a class='university-banner-img' data-attr-university-id='{{university.id}}'>
                        <img style='width:100%; height:100%; max-height:200px; position:absolute; top:0; left:0; overflow:hidden; border-radius:0;' src="{{photo['url']}}" alt="User Image">
                      </a>
                      <a class="users-list-name" href="#">{{photo.keys()}}</a>
                      <span class="users-list-date">California</span>
                    </li>
                    {% endfor %}
                  </ul><!-- /.users-list -->
                </div><!-- /.box-body -->
                <div class="box-footer text-center">
                  <a href="#" onclick="alert(&quot;coming-soon!&quot;)" class="uppercase">View All Universities</a>
                </div><!-- /.box-footer -->
              </div><!--/.box -->
            </div>
          </div>

        </section>

      </div>

{% endblock %}

{% block footer_scripts %}
<script src="/static/admin/plugins/ionslider/ion.rangeSlider.min.js" type="text/javascript"></script>
<script src="/static/admin/plugins/ionslider/ion.rangeSlider.min.js" type="text/javascript"></script>
<script src="/static/admin/plugins/datepicker/bootstrap-datepicker.js" type="text/javascript"></script>
<script src="/static/admin/plugins/timepicker/bootstrap-timepicker.js" type="text/javascript"></script>
<script src="/static/js/admin/mandrill.js" type="text/javascript"></script>
<script>
  $(document).ready(function() {
    console.log('document is ready');
    $('a.university-banner-img').click(function($event){
      var university_id = $(this).data().attrUniversityId;
      var child_img = $(this).children('img')[0];
      var img_src = $(child_img).attr('src');
      var payload = {
        university_id: university_id,
        university_banner:img_src
      }
      updateUniversityBannerUrl(payload);
    })
  });

  var updateUniversityBannerUrl = function(payload) {

    BASE_URL = "/api/admin/";
    auth_token = "fe78e1c1cddfe4b132c7963136243aa51ac5609fb17839bf65a446d6";

    $.ajax({
      url: BASE_URL + auth_token + "/universities/" + payload.university_id ,
      type: 'PUT',
      dataType: 'json',
      data: payload,
      success: function(resp){
        alert('university updated!');
        window.location.replace('/admin/stats/universities/complete');
      },
      error: function(err){
        alert("Error tell Samir!");
        console.log(err);
      }
    });
  }
</script>

{% endblock %}