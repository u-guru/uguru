{% extends 'admin/base.html' %}

{% block header_scripts %}
<link href="/static/admin/plugins/ionslider/ion.rangeSlider.css" rel="stylesheet" type="text/css" />
    <!-- ion slider Nice -->
    <link href="/static/admin/plugins/ionslider/ion.rangeSlider.skinNice.css" rel="stylesheet" type="text/css" />
    <link href="/static/admin/plugins/datepicker/datepicker3.css" rel="stylesheet" type="text/css" />
    <link href="/static/admin/plugins/timepicker/bootstrap-timepicker.min.css" rel="stylesheet"/>
{% endblock %}

{% block content %}
 <!-- Content Wrapper. Contains page content -->

      <div class="content-wrapper" style="min-height: 918px;">
        <!-- Content Header (Page header) -->
        <section class="content-header">
          <h1>

            <!-- An example of wasting time doing formatting lol -- not our job -->

              <img src='{{university.logo_url}}' height="40" width="40">
            <!-- The nbsp; are required spaces -->
            &nbsp;&nbsp;&nbsp;
            {{university.name}}
            <small><strong> {{university.city}}, {{university.state}}</strong></small>
          </h1>
          <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-bar-chart-o"></i> Home</a></li>
            <li>Stats</li>
            <li class="active">Devices</li>
          </ol>
        </section>


        <section class="content">

         <div class="row">
            {% for photo in flickr_arr %}
            <div class="col-md-4">
              <!-- USERS LIST -->
              <div class="box box-danger">
                <div class="box-header with-border">
                  <h3 class="box-title">{{photo.title}}</h3>
                  <p>{{photo.description._content[0:100]}}</p>
                  <br>
                  <span class="label label-warning">{{photo.views}}</span>
                  <div class="box-tools pull-right">

                    <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                    <button class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                  </div>
                </div><!-- /.box-header -->
                   <div class="box-body">
                        <a class='university-banner-img' data-attr-university-id='{{university.id}}'>
                          <div style='background:url({{photo["url"]}}); background-size:cover;height:100%;width:100%; max-height:250px; min-height:200px;'> </div>
                        </a>
                    </div><!-- /.box-body -->
              </div><!--/.box -->
            </div>
            {% endfor %}
          </div>

        </section>

      </div>

{% endblock %}

{% block footer_scripts %}
<script src="/static/admin/plugins/ionslider/ion.rangeSlider.min.js" type="text/javascript"></script>
<script src="/static/admin/plugins/ionslider/ion.rangeSlider.min.js" type="text/javascript"></script>
<script src="/static/admin/plugins/datepicker/bootstrap-datepicker.js" type="text/javascript"></script>
<script src="/static/admin/plugins/timepicker/bootstrap-timepicker.js" type="text/javascript"></script>
<script src="/static/js/admin/mandrill.js" type="text/javascript"></script>
<script>
  $(document).ready(function() {
    console.log('document is ready');
    $('a.university-banner-img').click(function($event){
      var university_id = $(this).data().attrUniversityId;
      var child_img = $(this).children('div')[0];
      var img_src = $(child_img).css('background-image').replace('url(','').replace(')','');
      var payload = {
        university_id: university_id,
        university_banner:img_src
      }
      updateUniversityBannerUrl(payload);
    })
  });

  var updateUniversityBannerUrl = function(payload) {

    BASE_URL = "/api/admin/";
    auth_token = "fe78e1c1cddfe4b132c7963136243aa51ac5609fb17839bf65a446d6";

    $.ajax({
      url: BASE_URL + auth_token + "/universities/" + payload.university_id ,
      type: 'PUT',
      dataType: 'json',
      contentType: "application/json",
      data: JSON.stringify(payload),
      success: function(resp){
        alert('university updated!');
        window.location.replace('/admin/stats/universities/complete/banners');
      },
      error: function(err){
        alert("Error tell Samir!");
        console.log(err);
      }
    });
  }
</script>

{% endblock %}