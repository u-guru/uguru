{% extends 'web/base.html' %}
{% set payment_details_dict = rating.get_payment_details_dict() %}

{% if user.id == rating.student_id %}
  {% set is_student = True %}
{% else %}
  {% set is_student = False %}
{% endif %}

{% block main_header %}
<header class="bar bar-nav">
</header>
{% endblock %}

{% block main_content %}
<div class="content should-hide-message-bar should-hide-tab-bar">

    <div class="rating-title">
        <p>Session Complete!</p>
    </div>
    <h6 class='center'>
            {{rating.time_created.strftime('%h %d %Y, %I:%M %p')}}
    </h6>
    {% if is_student %}
    <div class="rating-price">
        <p class='green-text'><span style='font-weight:100'>$</span>{{payment_details_dict['student_cost']}}</p>
    </div>
    <div class="border-frame">
      <div class="border-line center">
          <span class='micro-grey-text'>
            RATE YOUR GURU
          </span>
      </div>
    </div>
    <div class="rating-container relative">
        <div class='rating-person-container'>
          <div class="table-view-face rating-face" style='background-image: url("{{payment_details_dict['guru']['profile_url']}}")'></div>
          <div class="rating-name">
                <p>{{payment_details_dict['guru']['name']}}, {{payment_details_dict['skill_name']}}</p>
          </div>
        </div>
    </div>
    {% else %}
    <div class="rating-price">
        <p class='green-text'><span style='font-weight:100'>$</span>{{payment_details_dict['guru_earnings']}}</p>
    </div>
    <div class="border-frame">
      <div class="border-line center">
          <span class='micro-grey-text'>
            RATE YOUR STUDENT
          </span>
      </div>
    </div>
    <div class="rating-container relative">
        <div class='rating-person-container'>
          <div class="table-view-face rating-face" style='background-image: url("{{payment_details_dict['student']['profile_url']}}")'></div>
          <div class="rating-name">
                <p>{{payment_details_dict['student']['name']}}, {{payment_details_dict['skill_name']}}</p>
          </div>
        </div>
    </div>
    {% endif %}
    <div class="border-frame">
      <div class="border-line">
      </div>
    </div>
    <div id='submit-rating-container'class="rating-container-starts" data-rating-id='{{rating.id}}'>
        <ul class="table-ul">
          <li><a class='rating-star' href='#'><span class="icon icon-star guru-rating-star black"></span></a></li>
          <li><a class='rating-star' href='#'><span class="icon icon-star guru-rating-star black"></span></a></li>
          <li><a class='rating-star' href='#'><span class="icon icon-star guru-rating-star black"></span></a></li>
          <li><a class='rating-star' href='#'><span class="icon icon-star guru-rating-star black"></span></a></li>
          <li><a class='rating-star' href='#'><span class="icon icon-star guru-rating-star black"></span></a></li>
        </ul>
    </div>
  <script>
  $(document).ready(function() {
    //hide header
    $('header').hide();
    $('.content').css('padding-top','0px');
    //home
    $('a.rating-star').on('touchstart click', function () {
        var index = $(this).index('a.rating-star');
        //Entire ratings plugin implemented in the two lines below
        $( ".guru-rating-star" ).slice(0, index + 1).removeClass('icon-star').addClass('icon-star-filled');
        $( ".guru-rating-star" ).slice(index + 1, $('.guru-rating-star').length).removeClass('icon-star-filled').addClass('icon-star');

        var rating_id = ($('#submit-rating-container').data().ratingId).toString();

        payload = JSON.stringify({
            rating: (index + 1)
        });

        $.ajax({
            url: '/api/v1/ratings/' + rating_id,
            type: 'PUT',
            contentType: 'application/json',
            data: payload,
            success: function(request){
                window.PUSH({
                    transition : "fade",
                    url : "/m/home/"
                });
            },
            error: function (request) {
            
            }
        });
      });
  });
  </script>
{% endblock %}