{% extends 'web/base.html' %}
{% set request_dict = _request.get_return_dict() %}
{% block main_header %}
<header class="bar bar-nav">
          <a class="icon icon-left pull-left" href="/m/home/" data-transition='slide-out'></a>
          <h1 class="title">Reject {{request_dict['interested_tutors'][0]['name']}}</h1>
        </header>
{% endblock %}
{% block main_content %}
<div class="content should-hide-message-bar should-hide-tab-bar">
  <div class='content-padded'>
    <form>
      <textarea id='student-reject-guru-description' placeholder='Please tell us why, and we will try out best to send another Guru your way for this request.' rows="5"></textarea>
      <a class='btn btn-positive btn-block' href='#' data-request-id='{{request_dict["server_id"]}}' data-tutor-id='{{request_dict["interested_tutors"][0]["server_id"]}}' id='student-reject-guru-link'>
          Submit 
      </a>
    </form>
  </div>
  <script>
    $('#student-reject-guru-link').on('click', function() {

        request_id = ($(this).data().requestId).toString();
        tutor_id = ($(this).data().tutorId).toString();
        
        payload = JSON.stringify({
            action:'student-reject',
            description:$('#student-reject-guru-description').val(),
            tutor_server_id: tutor_id
        });

        $.ajax({
            url: '/api/v1/requests/' + request_id,
            type: 'PUT',
            contentType: 'application/json',
            data: payload,
            success: function(request){
                window.PUSH({
                    transition : "fade",
                    url : '/m/home/'
                });
            },
            error: function (request) {
                alert(request.responseJSON['errors']);
            }
        });
    });
  </script>

</div>
{% endblock %}