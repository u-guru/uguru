{% extends 'web/base.html' %}

{% if _request %}
  {% set request_dict = _request.get_return_dict() %}
{% endif %}

{% if guru %}
  {% set guru_avg_rating = guru.calc_avg_rating()[0] %}
  {% set guru_num_sessions = guru.calc_avg_rating()[1] %}
{% endif %}

{% block main_header %}
<header class="bar bar-nav grey-shade-3 no-border-bottom">
  {% if _request and guru and student %}
  <h1 class="title">My Profile
  </h1>
  <a class="icon icon-left-nav pull-left" href="/m/home/" data-transition="slide-out"></a>
  {% endif %}
  {% if guru %}
  <a class="icon icon-left-nav pull-left" href="/m/guru/" data-transition="slide-out"></a>
  <a class="btn btn-link pull-right" href="/m/guru/profile/edit/" data-transition="slide-in">edit</a>
  {% endif %}
  {% if student %}
  <h1 class="title">
  </h1>
  <a class="icon icon-left-nav pull-left" href="/m/home/" data-transition="slide-out"></a>
  <a class="btn btn-link pull-right" href="/m/profile/edit/" data-transition="slide-in">Edit</a>
  {% endif %}
  
</header>
{% endblock %}

{% block main_content %}
<div class="content should-hide-message-bar should-hide-tab-bar">
    
    <!-- Student case -->
    {% if student and not guru and not _request %}
      <ul class="table-view" style='margin-top:-10px;'>
        <li style='height:35%' class="table-view-cell media center ignore-table-view-margin grey-shade-3">
          <img class="media-object table-view-large-face" src="{{student.as_dict().profile_url}}">
          <p class='white-text center font-20 margin-top-10'>
            {{student.get_first_name()}} <br>
            UC Berkeley
          </p>
        </li>
        <li class="table-view-cell media grey-shade-2 ignore-table-view-margin">
          <h2> My Major 
            {% if student.major %}
            <span class='pull-right' style='color:#db7500'>{{student.major}}</span>
            {% else %}
            <a class='btn btn-link pull-right' href="/m/profile/edit/">add</a>
            {% endif %}
          </h2>
          
        </li>
        <li class="table-view-cell media grey-shade-2 ignore-table-view-margin">
          <h2> My Year 

            {% if student.year %}
            <span class='pull-right' style='color:#db7500'>{{student.year}}</span>
            {% else %}
            <a class='btn btn-link pull-right' href="/m/profile/edit/">add</a>
            {% endif %}
          </h2>
        </li>
      </ul>

    {% elif guru and not _request  %}

    <ul class="table-view" style='margin-top:-10px;'>
        <li style='height:35%' class="table-view-cell media center ignore-table-view-margin grey-shade-3">
          <img class="media-object table-view-large-face" src="{{guru.as_dict().profile_url}}">
          <p class='white-text center font-20 margin-top-10'>
            {{guru.get_first_name()}} <br>
            UC Berkeley
          </p>
        </li>
        <li class="table-view-cell media grey-shade-2 ignore-table-view-margin">
          <h2> My Major 
            {% if guru.major %}
            <span class='pull-right' style='color:#db7500'>{{guru.major}}</span>
            {% else %}
            <a class='btn btn-link pull-right' href="/m/guru/profile/edit/">add</a>
            {% endif %}
          </h2>
          
        </li>
        <li class="table-view-cell media grey-shade-2 ignore-table-view-margin">
          <h2> My Year 

            {% if guru.year %}
            <span class='pull-right' style='color:#db7500'>{{guru.year}}</span>
            {% else %}
            <a class='btn btn-link pull-right' href="/m/guru/profile/edit/">add</a>
            {% endif %}
          </h2>
        </li>
      </ul>

    <!-- Student Viewing Guru -->
    {% elif guru and _request  %}

              {{guru.get_first_name()}} is a new to Guru

          </h5>
            {% if _request %}
              {% if request_dict.get('incoming-tutor-replies') %}
              <p>
                <i>Hi Ben, I can definitely help you with this task. I've helped several students with this project. Don't worry, I got you.</i>
              </p>
              {% endif %}
            {% endif %}

            {{guru_avg_rating}} 
                    | 
            {{guru_num_sessions}}

            {% if _request %}
              <button class='btn btn-primary'>{{request_dict['skill_name']|upper}}</button>
              {% for skill in guru.skills[:3] %}
                
                {% set skill_name = skill.get_short_name() %}
                
                {% if skill_name != request_dict['skill_name'] 
                  and skill_name not in ['Writing Help', 'Career Help', 'Resume Help']
                %}
                  <button class='btn btn-outlined'>{{skill_name}}</button>
                {% endif %}

              {% endfor %}

                {% for skill in guru.skills %}
                
                {% set skill_name = skill.get_short_name() %}
                <button class='btn btn-outlined'>{{skill_name}}</button>
                {% endfor %}
            {% endif %}
          {{guru.get_first_name()}}'s Introduction
                  {{guru.tutor_introduction}}

    {% endif %}
    </ul>  
</div>
{% endblock %}

