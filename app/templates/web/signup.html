{% extends 'web/base.html' %}

{% block main_header %}
<header id='header-bar' class="bar bar-nav no-border-bottom login-header">
  <a class="icon icon-left pull-left" href='/m/welcome/' data-transition='slide-out'></a>
  <h1 class="title">Sign Up</h1>
</header>
{% endblock %}

{% block main_content %}

<div class="content should-hide-message-bar should-hide-tab-bar">
    <div id='signup-errors' class='center error-text error-div margin-top-20'>Please fill in all fields</div>
    <form class="input-group" id="signup-form">
        <div class='input-row'>
            <label>First</label>
            <input type="text" id="name-field" placeholder="your first name"></input>
        </div>
        <div class='input-row'>
            <label>Last</label>
            <input type="email" id="name-field-last" placeholder="your last name"></input>
        </div>
        <div class='input-row'>
            <label>Email</label>
            <input type="email" id="email-field" placeholder="peter.parker@berkeley.edu"></input>
        </div>
    </form>
    <form class="input-group" id="signup-form">
    <div class='input-row margin-top-10'>
        <label>Password</label>
        <input type="password" id="password-field" placeholder="at least 6 characters"></input>
    </div>
</form>
    <a class="btn btn-positive btn-block" data-transition='slide-in' href="#" id="signup-link">Join Uguru</a>
    <script>
    $(document).ready(function() {
        $('#signup-link').click(function(){
            
            //client side validation
            if (!($('#name-field').val() && $('#name-field-last').val() 
                && $('#email-field').val() && $('#password-field').val() ))
            {
                $('#signup-errors').text('Please fill in all fields');
                $('#signup-errors').show();
                return;
            }


            name = $('#signup-form #name-field').val() + ' ' +$('#signup-form #name-field-last').val()

            payload = JSON.stringify({
                name     : name,
                email    : $('#signup-form #email-field').val(),
                password : $('#signup-form #password-field').val()
            });

            $.ajax({
                url: '/api/v1/signup',
                type: 'POST',
                contentType: 'application/json',
                data: payload,
                success: function(request){
                    window.PUSH({
                        transition : "slide-in",
                        url : "/m/home/"
                    });
                },
                error: function (request) {
                    $('#signup-errors').text(request.responseJSON['errors']);
                    $('#signup-errors').show();
                    return;

                }
            });
        });
    });
</script>
</div>

{% endblock %}
