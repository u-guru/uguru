{% extends 'web/base.html' %}
{% from 'web/macros/request.html' import request_details_student, student_reject_modal, student_accept_modal, cancel_request_modal,
request_details_guru, student_scheduled_session %}
{% set scheduled_sessions = user.get_scheduled_sessions_student() %}
{% set student_requests = user.get_student_requests() %}

{% if student_requests %}
  {% set request_dict = student_requests[0].get_return_dict() %}
  {% set available_guru = request_dict.get('interested_tutors') %}
{% endif %}

{% block main_header %}
<header class="bar bar-nav">
  <h1 class="title">Student {{user.get_first_name()|title}}<br><span id='countdown'></span></h1>
  <a class='btn btn-link' id='profile-title-bar-icon' data-transition='fade'href='/m/profile/{{user.id}}'>
  <img id='guru-profile-photo' src='{{user.as_dict().profile_url}}'class="media-object pull-right table-view-mini-face profile-title-icon"/>
  </a>
  <a class='btn btn-link pull-right' data-transition='fade' href='/m/support/'>Help</a>
</header>
{% endblock %}

{% block main_content %}
<div class="content should-hide-message-bar">
{% if not scheduled_sessions and not student_requests %}
  <div class='logo-container center content-padded'>
    <img class="media-object guru-photo" src="/static/img/guru-new.svg">
  </div>
{% endif %}


  {% if student_requests %}
      {{request_details_student(request_dict, available_guru)}}
  {% endif %}
  
  {% if (student_requests and scheduled_sessions) %}
    <ul class='table-view'>
      <li class='table-view-cell'>
        <a class='navigate-right' href='/m/upcoming/' data-transition='slide-out'>
          See all scheduled sessions 
          <span class='badge badge-negative'>
            {{scheduled_sessions|length}}
          </span>
        </a>
      </li>
    </ul>
  {% elif scheduled_sessions|length > 1 %}
    {{student_scheduled_session(scheduled_sessions[0])}}
    <ul class='table-view'>
      <li class='table-view-cell'>
        <a class='navigate-right' href='/m/upcoming/' data-transition='slide-out'>
          See all scheduled sessions 
          <span class='badge badge-negative'>
            {{scheduled_sessions|length}}
          </span>
        </a>
      </li>
    </ul>
  {% elif scheduled_sessions %}
  <ul class='table-view'>
      {{student_scheduled_session(scheduled_sessions[0])}}
  </ul>
  {% endif %}



  

    {% if not student_requests %}
    <a class="btn btn-positive btn-block request-guru-btn" href="/m/request_form/" data-transition='slide-in'>
      Request Guru
    </a>
    {% elif not available_guru %}
      <button class='btn btn-block btn-negative request-guru-btn' id='negative-guru-request-btn'>
        Request a Guru
      </button>
    {% endif %}

  {% include 'web/snippets/flash_alerts.html'%}
  {{show_all_components(user, student_mode)}}

</div><!-- /.content -->
<script>

$('#negative-guru-request-btn').on('click touchstart', function() {
    alert('Sorry! Only one request at a time. Once you are connected with a Guru, you can make another one!');
});
mixpanel.identify('{{user.id}}');
mixpanel.track_links("#negative-guru-request-btn", "Negative guru request button clicked");
mixpanel.track_links(".request-guru-btn", "Regular request guru button clicked");
mixpanel.track_links("#profile-title-bar-icon", "Negative guru request button clicked");

</script>
{% endblock %}
