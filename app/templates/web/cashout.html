{% extends 'web/base.html' %}



{% if redirect == 'home' %}
    {% set redirect_url = '/m/guru/' %}
{% else %}
    {% set redirect_url = '/m/guru/settings/' %}
{% endif %}


{% block main_header %}
<header class="bar bar-nav">
      <h1 class="title">Cashout</h1>
      <a href='{{redirect_url}}' data-transition='slide-out' class='icon icon-left pull-left'></a>
</header> 
{% endblock %}


{% block main_content %}
<div class="content should-hide-message-bar should-hide-tab-bar">
      <ul class='table-view'>
        <li class='table-view-cell center ignore-table-view-margin'>
          <h5> My Earnings </h5>
          <h1 style='font-size:40px; margin-top:20px; font-weight:bold' class='light-green-text'> ${{user.balance}} </h1>
        </li>
        
        <li class='table-view-cell ignore-table-view-margin'>
          <a class='navigate-right' href='/m/add_cash_card/home/' data-transition='slide-in'>
            <p>Debit Card **{{user.recipient_last4}}
            </p>
          </a>
        </li>
      </ul>
      <a data-user-id='{{user.id}}' id='guru-cashout-link' class="btn btn-positive btn-block">Cash Out</a>


      <script>
        $('#guru-cashout-link').on('click', function() {

            var user_id = ($(this).data().userId).toString();

            payload = JSON.stringify({
                'guru-cashout':true
            });
            
            $.ajax({
                url: '/api/v1/users/' + user_id,    
                type: 'PUT',
                contentType: 'application/json',
                data: payload,
                success: function(request){
                    window.PUSH({
                        transition : "fade",
                        url : '{{redirect_url}}'
                    });
                },
                error: function (request) {
                    alert(request.responseJSON['errors']);
                }
            });
        });
    </script>


</div>
{% endblock %}

