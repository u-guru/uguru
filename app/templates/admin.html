{% extends 'base.html' %}

{% block header %}
    <link href="/static/css/admin.css" rel="stylesheet">
{% endblock %}

{% block content %}

<ul style="margin:auto;float:center" class="nav nav-tabs">
  <li class="active"><a href="#tutors" data-toggle="tab">Tutors</a></li>
  <li><a href="#students" data-toggle="tab">Students</a></li>
  <li><a href="#analytics" data-toggle="tab">Analytics</a></li>
  <li><a href="#requests" data-toggle="tab">Requests</a></li>
  <li><a href="#notifications" data-toggle="tab">Notifications</a></li>
</ul>

<div class="tab-content">

  <div class="tab-pane active" id="tutors">
    <div class="container">
        <div style="margin:20px; text-align:center" class="row">
            # Tutors: {{tutor_count}}
        </div>
        <div class="row-fluid">
            <table class="table table-striped">
                <tr class="info"> 
                    <td> Id </td>
                    <td> Name </td>
                    <td> Email </td>
                    <td> Time </td>
                    <td> Refer Code </td>
                    <td> Skills </td>
                    <td> What's missing profile </td>
                </tr>
                {% for user in users %}
                        {% if user.verified_tutor %}
                        <tr> 
                            <td>  {{user.id}} </td>
                            <td> <a href="javascript:void(0)" class="login-user"> {{user.name}} </a> </td>
                            <td> {{user.email}} </td>
                            <td> {{pretty_dates[user.id]}} </td>
                            <td> {{user.referral_code}} </td>
                            <td> {{skills_dict[user.id]}}</td>
                            <td>
                                {% if user.profile and user.introduction and user.major%}
                                Complete
                                {% else %}
                                    {% if user.profile_url == '/static/img/default-photo.jpg' %}
                                    Profile, 
                                    {% endif %}
                                    {% if not user.tutor_introduction %}
                                    Introduction, 
                                    {% endif %}
                                    {% if not user.major %}
                                    Major
                                    {% endif %}
                                {% endif %}
                            </td>
                        </tr>
                        {% endif %}
                {% endfor %}
            </table>
        </div>
    </div>
  </div>

  <div class="tab-pane" id="students"> 
    <div class="tab-pane active" id="tutors">
        <div class="container">
            <div style="margin:20px; text-align:center" class="row">
            # Students: {{student_count}}
            </div>
            <div class="row-fluid">
                <table class="table table-striped">
                    <tr class="info"> 
                        <td> Id </td>
                        <td> Name </td>
                        <td> Email </td>
                        <td> Time </td>
                    </tr>
                    {% for user in users %}
                            {% if not user.skills %}
                            <tr> 
                                <td>  {{user.id}} </td>
                                <td> <a href="javascript:void(0)" class="login-user"> {{user.name}} </a> </td>
                                <td> {{user.email}} </td>
                                <td> {{pretty_dates[user.id]}} </td>
                            </tr>
                            {% endif %}
                    {% endfor %}
                </table>
            </div>
        </div>
      </div>

  </div>

  <div class="tab-pane" id="analytics"> 
    <div class="tab-pane active" id="tutors">
        <div class="container">
            <div style="margin:20px; text-align:center" class="row">
            </div>
            <div class="row-fluid">
                <table class="table table-striped">
                    <tr class="info"> 
                        <td> Skill </td>
                        <td> Count </td>
                    </tr>
                    {% for row in skills_counter|reverse %}
                        <tr> 
                            <td>  {{row[0]}} </td>
                            <td>  {{row[1]}} </td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
      </div>

  </div>

  <div class="tab-pane" id="notifications"> 
    <div class="tab-pane active" id="tutors">
        <div class="container">
            <div style="margin:20px; text-align:center" class="row">
            </div>
            <div class="row-fluid">
                <table class="table table-striped">
                    <tr class="info"> 
                        <td> ID </td>
                        <td> Type </td>
                        <td> Request ID </td>
                        <td> Feed Message </td>
                    </tr>
                    {% set valid_tags = ['student-request-help', 'tutor-request-offer', 'tutor-accept-offer', 'student-incoming-offer'] %}
                        {% for n in notifications %}
                            {% if n.custom_tag in valid_tags %}
                            <tr> 
                                <td>  {{n.id}} </td>
                                <td>  {{n.custom_tag}} </td>
                                <td>  {{n.request_id}} </td>
                                <td>  {{n.feed_message[0:30]|safe}} </td>
                            </tr>
                            {% endif %}
                        {% endfor %}
                </table>
            </div>
        </div>
      </div>
  </div>

  <div class="tab-pane" id="requests"> 
    <div class="tab-pane active" id="tutors">
        <div class="container">
            <div style="margin:20px; text-align:center" class="row">
            </div>
            <div class="row-fluid">
                <table class="table table-striped">
                    <tr style="font-size:12px"class="info"> 
                        <td> Id </td>
                        <td> Student </td>
                        <td> Class / Skill </td>
                        <td> # Students </td>
                        <td> Availability </td>
                        <td> Time Estimate </td>
                        <td> Hourly Price </td>
                        <td> #Tutors Avail </td>
                        <td> #Tutors Seen </td>
                        <td> #Tutors Replied </td>
                        <td> Time Created </td>
                    </tr>
                    {% for request_dict in all_requests %}
                        {% if request_dict['student'].name %}
                        <tr> 
                            <td>  
                                {{request_dict['request'].id}}
                            </td>
                            <td>  
                                {{request_dict['student'].name}} (id:{{request_dict['request'].student_id}})
                            </td>
                            <td> 
                                {{request_dict['skill_name']}} 
                            </td>
                            <td>  
                                {{request_dict['request'].num_students}} 
                            </td>
                            <td>  
                                {{request_dict['request'].available_time}} 
                            </td>
                            <td>  
                                {{request_dict['request'].time_estimate}} 
                            </td>
                            <td>  
                                ${{request_dict['request'].student_estimated_hour}}
                            </td>
                            <td>  
                                {{request_dict['request'].requested_tutors|length}} 
                            </td>
                            <td>  
                                {{request_dict['total_seen']}} 
                            </td>
                            <td>  
                                {{request_dict['request'].committed_tutors|length}} 
                            </td>
                            <td>  
                                {{request_dict['date']}}
                            </td>
                        </tr>
                        {% endif %}
                    {% endfor %}
                </table>
            </div>
        </div>
      </div>
  </div>


</div>

{% endblock %}

{% block footer_scripts %}
    <script src="/static/js/admin.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
{% endblock %}