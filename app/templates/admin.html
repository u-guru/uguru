{% extends 'base.html' %}

{% block header %}
    <link href="/static/css/admin.css" rel="stylesheet">
{% endblock %}

{% block content %}

<ul style="margin:auto;float:center" class="nav nav-tabs">
  <li class="active"><a href="#tutors" data-toggle="tab">Tutors</a></li>
  <li><a href="#students" data-toggle="tab">Students</a></li>
  <li><a href="#analytics" data-toggle="tab">Analytics</a></li>
  <li><a href="#requests" data-toggle="tab">Requests</a></li>
  <li><a href="#notifications" data-toggle="tab">Notifications</a></li>
  <li><a href="#payments" data-toggle="tab"> Payments</a></li>
  <li><a href="#ratings" data-toggle="tab"> Ratings</a></li>
</ul>

<div class="tab-content">

  <div class="tab-pane active" id="tutors">
    <div class="container">
        <div style="margin:20px; text-align:center" class="row">
            # Tutors: {{tutor_count}}
        </div>
        <div class="row-fluid">
            <table class="table table-striped">
                <tr class="info"> 
                    <td> Id </td>
                    <td> Name </td>
                    <td> Email </td>
                    <td> Time </td>
                    <td> Refer Code </td>
                    <td> Skills </td>
                    <td> What's missing profile </td>
                </tr>
                {% for user in users %}
                        {% if user.verified_tutor %}
                        <tr> 
                            <td>  {{user.id}} </td>
                            <td> <a href="javascript:void(0)" class="login-user"> {{user.name}} </a> </td>
                            <td> {{user.email}} </td>
                            <td> {{pretty_dates[user.id]}} </td>
                            <td> {{user.referral_code}} </td>
                            <td> {{skills_dict[user.id]}}</td>
                            <td>
                                {% if user.profile and user.introduction and user.major%}
                                Complete
                                {% else %}
                                    {% if user.profile_url == '/static/img/default-photo.jpg' %}
                                    Profile, 
                                    {% endif %}
                                    {% if not user.tutor_introduction %}
                                    Introduction, 
                                    {% endif %}
                                    {% if not user.major %}
                                    Major
                                    {% endif %}
                                {% endif %}
                            </td>
                        </tr>
                        {% endif %}
                {% endfor %}
            </table>
        </div>
    </div>
  </div>

  <div class="tab-pane" id="students"> 
    <div class="tab-pane active" id="tutors">
        <div class="container">
            <div style="margin:20px; text-align:center" class="row">
            # Students: {{student_count}}
            </div>
            <div class="row-fluid">
                <table class="table table-striped">
                    <tr class="info"> 
                        <td> Id </td>
                        <td> Name </td>
                        <td> Email </td>
                        <td> Time </td>
                    </tr>
                    {% for user in users %}
                            {% if not user.skills %}
                            <tr> 
                                <td>  {{user.id}} </td>
                                <td> <a href="javascript:void(0)" class="login-user"> {{user.name}} </a> </td>
                                <td> {{user.email}} </td>
                                <td> {{pretty_dates[user.id]}} </td>
                            </tr>
                            {% endif %}
                    {% endfor %}
                </table>
            </div>
        </div>
      </div>

  </div>

  <div class="tab-pane" id="analytics"> 
    <div class="tab-pane active" id="tutors">
        <div class="container">
            <div style="margin:20px; text-align:center" class="row">
            </div>
            <div class="row-fluid">
                <table class="table table-striped">
                    <tr class="info"> 
                        <td> Skill </td>
                        <td> Count </td>
                    </tr>
                    {% for row in skills_counter|reverse %}
                        <tr> 
                            <td>  {{row[0]}} </td>
                            <td>  {{row[1]}} </td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
      </div>
  </div>

  <div class="tab-pane" id="ratings"> 
    <div class="tab-pane active" id="tutors">
        <div class="container">
            <div style="margin:20px; text-align:center" class="row">
            </div>
            <div class="row-fluid">
                <table class="table table-striped">
                    <tr class="info"> 
                        <td> ID </td>
                        <td> Role </td>
                        <td> Class </td>
                        <td> Rating </td>
                        <td> Description</td>
                    </tr>
                    {% for rating in ratings|sort(attribute='time_created')|reverse %}
                        <tr> 
                            <td> {{rating.id}} </td>
                            <td> {{ratings_dict[rating]['tutor-name']}} (tutor) reviewing {{ratings_dict[rating]['student-name']}}</td>
                            <td> {{ratings_dict[rating]['skill']}}</td>
                            <td> {{rating.tutor_rating}}</td>
                            <td> {{rating.tutor_rating_description}}</td>
                        </tr>
                        <tr> 
                            <td> {{rating.id}} </td>
                            <td> {{ratings_dict[rating]['student-name']}} (student) reviewing {{ratings_dict[rating]['tutor-name']}}</td>
                            <td> {{ratings_dict[rating]['skill']}}</td>
                            <td> {{rating.student_rating}}</td>
                            <td> {{rating.student_rating_description}}</td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
      </div>
  </div>

  <div class="tab-pane" id="notifications"> 
    <div class="tab-pane active" id="tutors">
        <div class="container">
            <div style="margin:20px; text-align:center" class="row">
            </div>
            <div class="row-fluid">
                <table class="table table-striped">
                    <tr class="info"> 
                        <td> ID </td>
                        <td> Type </td>
                        <td> Request ID </td>
                        <td> Feed Message </td>
                    </tr>
                    {% set valid_tags = ['student-request-help', 'tutor-request-offer', 'tutor-accept-offer', 'student-incoming-offer'] %}
                        {% for n in notifications %}
                            {% if n.custom_tag in valid_tags %}
                            <tr> 
                                <td>  {{n.id}} </td>
                                <td>  {{n.custom_tag}} </td>
                                <td>  {{n.request_id}} </td>
                                <td>  {{n.feed_message[0:30]|safe}} </td>
                            </tr>
                            {% endif %}
                        {% endfor %}
                </table>
            </div>
        </div>
      </div>
  </div>

  <div class="tab-pane" id="payments"> 
    <div class="tab-pane active" id="tutors">
        <div class="container">
            <div style="margin:20px; text-align:center" class="row">
            </div>
            <div class="row-fluid">
                <table class="table table-striped">
                    <tr class="info"> 
                        <td> Student </td>
                        <td> Tutor </td>
                        <td> Time Amount </td>
                        <td> Student Hourly</td>
                        <td> Tutor Hourly</td>
                        <td> Student Charge </td>
                        <td> Tutor Paid </td>
                        <td> Profit </td>
                    </tr>
                        {% for payment_dict in payments %}
                            <tr> 
                                <td>  {{payment_dict['student'].name.split(" ")[0]}} (id:{{payment_dict['student'].id}})</td>
                                <td>  {{payment_dict['tutor'].name.split(" ")[0]}} (id:{{payment_dict['tutor'].id}})</td>
                                <td>  {{payment_dict['payment'].time_amount}}hours </td>
                                <td>  ${{payment_dict['student-hourly']}}</td>
                                <td>  ${{payment_dict['tutor-hourly']}}</td>
                                <td>  ${{payment_dict['student-total']}}</td>
                                <td>  ${{payment_dict['tutor-total']}}</td>
                                <td>  ${{payment_dict['profit']}}</td>
                            </tr>
                        {% endfor %}
                    <tr>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td style="font-weight:bold">
                            Total: 
                        </td>
                        <td style="font-weight:bold; color:green">
                            ${{total_profit}}
                        </td>
                    </tr>
                </table>
            </div>
        </div>
      </div>
  </div>

  <div class="tab-pane" id="requests"> 
    <div class="tab-pane active" id="tutors">
        <div class="container">
            <div style="margin:20px; text-align:center" class="row">
            </div>
            <div class="row-fluid">
                <table class="table table-striped">
                    <tr style="font-size:9px"class="info"> 
                        <td> ID </td>
                        <td> Student </td>
                        <td> Time Created </td>
                        <td> Class </td>
                        <td> # Students </td>
                        <td> Avail </td>
                        <td> Time </td>
                        <td> Hr Rate </td>
                        <td> #Tutors Avail </td>
                        <td> #Tutors Seen </td>
                        <td> #Tutors Replied </td>
                        <td> Connected Tutor </td>
                        <td> Messaged? </td>
                        <td> Payment? </td>
                        <td> Rated? </td>
                        <td> We made </td>
                    </tr>
                    {% for request_dict in all_requests %}
                        {% if request_dict['student'].name %}
                        <tr> 
                            <td>  
                                {{request_dict['request'].id}} 
                            </td>
                            <td>  
                                {{request_dict['student'].name.split(" ")[0]}} (id:{{request_dict['request'].student_id}})
                            </td>
                            <td>  
                                {{request_dict['date']}}
                            </td>
                            <td> 
                                {{request_dict['skill_name']}} 
                            </td>
                            <td>  
                                {{request_dict['request'].num_students}} 
                            </td>
                            <td>  
                                {{request_dict['request'].available_time}} 
                            </td>
                            <td>  
                                {{request_dict['request'].time_estimate}} 
                            </td>
                            <td>  
                                ${{request_dict['request'].student_estimated_hour}}
                            </td>
                            <td>  
                                {{request_dict['request'].requested_tutors|length}} 
                            </td>
                            <td>  
                                {{request_dict['total_seen']}} 
                            </td>
                            <td>  
                                {{(request_dict['request'].committed_tutors|length - 1)}} 
                            </td>
                            <td>  
                                {% if request_dict['connected-tutor'] %}
                                    {{request_dict['connected-tutor'].name.split(" ")[0]}} (id: {{request_dict['connected-tutor'].id}})
                                {% else %}
                                    None
                                {% endif %}
                            </td>
                            <td>
                                {% if request_dict['message-length'] > 0 %}
                                Yes
                                {% else %}
                                No
                                {% endif %}
                            </td>
                            <td>
                                {% if request_dict['payment'] %}
                                Yes
                                {% else %}
                                No
                                {% endif %}
                            </td>
                            <td>
                                {% if request_dict['pending-ratings'] >= 0 or request_dict['pending-ratings'] < 3%}
                                    {% if request_dict['pending-ratings'] == 2 %}
                                    Neither
                                    {% elif request_dict['pending-ratings'] == 1 %}
                                    One has
                                    {% else %}
                                    Both
                                    {% endif %}
                                {% endif%}
                            </td>
                            <td>
                                {% if request_dict['payment'] %}
                                    ${{request_dict['payment']}}
                                {% endif %}
                            </td>
                        </tr>
                        {% endif %}
                    {% endfor %}
                </table>
            </div>
        </div>
      </div>
  </div>


</div>

{% endblock %}

{% block footer_scripts %}
    <script src="/static/js/admin.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
{% endblock %}